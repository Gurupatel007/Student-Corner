<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New Password - Studentcorner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <style>
        body {
            font-family: "Montserrat", sans-serif;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #18181b, #27272a, #3f3f46);
        }
        .text-gradient {
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-image: linear-gradient(45deg, #a855f7, #3b82f6);
        }
    </style>
</head>

<body class="gradient-bg text-white">
    <div class="flex h-screen">
        <div class="w-1/2 h-screen flex flex-col justify-center px-24 -mt-20">
            <h1 class="text-[2vw] mb-4 text-purple-300">New Password</h1>
            <h1 class="text-[7.5vw] font-bold text-gradient mb-2">Create</h1>
            <h1 class="text-[7.5vw] font-bold text-gradient">Password</h1>
        </div>
        <div class="w-1/2 h-screen py-20 pr-10 flex flex-col justify-center items-center">
            <div class="bg-zinc-800 w-full h-[88vh] p-20 rounded-xl shadow-lg">
                <form action="/update-password" id="password-update-form" method="post" class="space-y-8 animate__animated animate__fadeIn">
                    <input type="hidden" name="identifier" id="identifier" value="<%= identifier %>">
                    <div>
                        <label for="newPassword" class="block font-bold text-[1.4vw] mb-2 uppercase">New Password:</label>
                        <input type="password" id="newPassword" name="newPassword" placeholder="Enter New Password" required
                            class="w-full px-5 py-3 text-[1vw] bg-zinc-700 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div>
                        <label for="confirmPassword" class="block font-bold text-[1.4vw] mb-2 uppercase">Confirm Password:</label>
                        <input type="password" id="confirmPassword" name="confirmPassword" placeholder="Confirm Password" required
                            class="w-full px-5 py-3 text-[1vw] bg-zinc-700 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                    </div>
                    <button type="submit" class="w-40 h-16 bg-purple-600 hover:bg-purple-700 text-white font-semibold text-[1.1vw] rounded-md transition duration-300 uppercase">
                        Submit
                    </button>
                </form>
            </div>
        </div>
    </div>
    <script>
    document.getElementById('password-update-form').addEventListener('submit', function(e) {
        e.preventDefault();
    
        const identifier = document.getElementById('identifier').value;
        const newPassword = document.getElementById('newPassword').value;
        const confirmPassword = document.getElementById("confirmPassword").value;

        console.log("New Password:", newPassword);
        console.log("Confirm Password:", confirmPassword);
    
        if (newPassword !== confirmPassword) {
            Swal.fire(
                'Error!',
                'Passwords do not match.',
                'error'
            );
            return;
        }
    
        fetch('/update-password', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ identifier, newPassword, confirmPassword })
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            if (data.status === 'success') {
                Swal.fire(
                    'Success!',
                    'Password has been updated.',
                    'success'
                ).then(() => {
                    window.location.href = "/signin";
                });
            } else {
                Swal.fire(
                    'Error!',
                    data.message,
                    'error'
                );
            }   
        })
        .catch(error => {
            console.error('There has been a problem with your fetch operation:', error);
        });
    });
    </script>
</body>

</html>